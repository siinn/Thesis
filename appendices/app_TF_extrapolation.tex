\section{Extrapolation in the Track Flipping Method}
In this section, the extrapolation method used in the TF method is derived. The TF method estimates the number of vertices in the control (\xx), validation (\mux, \ex), and signal region (\mumu, \ee, \emu) which represent the estimate of random-crossing background in each region. %However, because of limited number in lepton pairs in the data sample, it is not practical to use the vertex yields in the signal region to estimate the background. Instead,
The vertex yields in the control and validation region are extrapolated into the signal region to estimate the random-crossing background.



\subsection{Definition}
In this derivation, the following definition of $\mu$, $e$, and x is used where lepton and non-leptonic tracks are mutually exclusive.
\begin{itemize}
\item x = tracks that are not $\mu$ or $e$
\item $e$ = electron tracks
\item $\mu$ = muon tracks 
\end{itemize}

Furthermore, the following conventions for the number of tracks, pairs, vertices, and lepton probability are used.
\begin{itemize}
\item \Nx, \Ne, \Nm represent the number of x, $e$, and $\mu$ tracks.
\item \Nxx, \Nmx, \Nex, \Nmm, \Nee, \Nem represent the number of pairs of each type.
\item \NVxx{}, \NVmx{}, \NVex{}, \NVmm{}, \NVee{}, \NVem{} represent the number of vertices of each type.
\item $\Pm = \frac{\Nm}{\Nm + \Ne + \Nx}$ represents the probability for a track being a muon.
\item $\Pe = \frac{\Ne}{\Nm + \Ne + \Nx}$ represents the probability for a track being an electron.
\end{itemize}


\subsection{Vertex Estimation}
The number of reconstructed vertices in the sample can be estimated by the number of track pairs in the sample and the probability of a pair to form a vertex, i.e.
\begin{equation}
\NVxx{est} = \Nxx \times \Pxx,
\end{equation}
%
where $\Pxx$ is the probability for a xx pair to form a vertex. Similarly, the vertexing probability for track pairs in the validation and signal region can be defined as below.
\begin{align}
\label{estimation_generic}
\NVmx{}& = \Nmx \times \Pmx, \nonumber \\
\NVex{} &= \Nex \times \Pex, \nonumber \\
\NVmm{} &= \Nmm \times \Pmm, \nonumber \\
\NVee{} &= \Nee \times \Pee, \nonumber \\
\NVem{} &= \Nem \times \Pem.
\end{align}



\subsection{Counting Pairs}
Given a collection of x tracks in a single event, the number of all possible pairs can be expressed as,
\begin{equation}
\label{counting_pairs1}
\Nxx = \binom{\Nx}{2} = \frac{\Nx!}{(\Nx-2)! 2!} = \frac{1}{2} \Nx\cdot(\Nx-1).
\end{equation}
%
Given two different sets of tracks, for example x and $\mu$, the number of possible pairs is
\begin{equation}
\Nmx = \Nm \cdot \Nx.
\end{equation}
%
Similarly, the number of pairs from other combinations of tracks are
\begin{align}
\label{counting_pairs2}
\Nee &= \binom{\Ne}{2} = \frac{\Ne!}{(\Ne-2)! 2!} = \frac{1}{2} \Ne\cdot(\Ne-1), \nonumber\\
\Nmm &= \binom{\Nm}{2} = \frac{\Nm!}{(\Nm-2)! 2!} = \frac{1}{2} \Nm\cdot(\Nm-1), \nonumber\\
\Nex &= \Ne \cdot \Nx,\nonumber \\
\Nem &= \Ne \cdot \Nm.
\end{align}

%Note that Eqs.~\ref{counting_pairs1}-\ref{counting_pairs2} are only true event-wise. If there are \Nx tracks in data, it can not be directly translated to $\Nxx$ using Eq.~\ref{counting_pairs1}. Instead, the sum of $\Nxx$ from each event needs to be calculated.

\subsection{Extrapolation of Control Region into Validation and Signal Regions}

The track-flipped vertex yield in the control region can be extrapolated into the validation and signal region as follows.

Given the number of tracks ($\mu$, $e$, x), we can estimate the number of vertices in the validation and signal region using Eqs.~\ref{estimation_generic}$-$\ref{counting_pairs2}. However the vertexing probabilities in the signal region ($\Pmm$, $\Pee$, $\Pem$) are unknown without using the information from the signal regions. Also, the vertexing probabilities in the validation region ($\Pmx$, $\Pex$) cannot be used due to small \Nmx, \Nex in data. Therefore, the vertexing probability obtained from the control region, $\Pxx$, is used as an estimation of the vertexing probability in the validation and the signal region. $\Pxx$ can be expressed as,

\begin{align}
\label{p_xx}
\Pxx &= \frac{\NVxx{obs}}{\Nxx} = \frac{\NVxx{obs}}{{\frac{1}{2} \Nx\cdot(\Nx-1)}}.
\end{align}
%
Using Eqs.~\ref{estimation_generic}-\ref{p_xx}, the vertex yield in the validation and signal region can be estimated as,
\begin{align}
\label{eq:TF_extrapolation_from_control}
\NVmx{est} &= \Nmx \cdot \Pmx \approx \Nmx \cdot \Pxx    = 2 \cdot \frac{\Nm}{\Nx -1} \cdot \NVxx{obs} \approx 2 \cdot \Pm \cdot \NVxx{obs},\nonumber\\
\NVex{est}   &= \Nex \cdot \Pex \approx \Nex \cdot \Pxx      = 2 \cdot \frac{\Ne}{\Nx -1} \cdot \NVxx{obs} \approx 2 \cdot \Pe \cdot \NVxx{obs}, \nonumber \\
\NVmm{est}&= \Nmm \cdot \Pmm \approx \Nmm \cdot \Pxx  = \frac{\Nm\cdot(\Nm - 1)}{\Nx\cdot(\Nx-1)} \cdot \NVxx{obs} \approx (\Pm)^{2} \cdot \NVxx{obs}, \nonumber \\
\NVee{est}    &= \Nee \cdot \Pee \approx \Nee \cdot \Pxx 		= \frac{\Ne\cdot(\Ne - 1)}{\Nx\cdot(\Nx-1)} \cdot \NVxx{obs} \approx (\Pe)^{2} \cdot \NVxx{obs}, \nonumber \\
\NVem{est} &= \Nem \cdot \Pem \approx \Nem \cdot \Pxx 	= \Ne \cdot \Nm \frac{2 \cdot \NVxx{obs}}{\Nx \cdot (\Nx-1)} \approx 2\cdot \Pe\cdot \Pm \cdot \NVxx{obs},
\end{align}
%
where $N^{\mathrm{v(obs)}}$ represents the measured track-flipped vertex yield in the data and $N^{\mathrm{v(est)}}$ represents the estimated vertex yield in the validation and signal region by the extrapolation.

\subsection{Extrapolation of Validation Region into Signal Region}
\label{app:ext_validation_into_signal}

Similarly, the track-flipped vertex yield in the validation region can be extrapolated into the signal region by using $\Pmx$ and $\Pex$ as estimates of $\Pmm$ and $\Pee$ where,
\begin{align}
\Pmx &= \frac{\NVmx{obs}}{\Nmx} = \frac{\NVmx{obs}}{\Nm \cdot \Nx}, \nonumber\\
\Pex &= \frac{\NVex{obs}}{\Nex} = \frac{\NVex{obs}}{\Ne \cdot \Nx}.
\end{align}
%
The track-flipped vertex yield in the validation region ($\NVmx{obs}$, $\NVex{obs}$) can be extrapolated into the signal regions by,
\begin{align}
\label{eq:TF_extrapolation_from_validation}
\NVmm{est}&= \Nmm \times \Pmm \approx \Nmm \times \Pmx  = \frac{1}{2} \cdot \frac{\Nm-1}{\Nx} \cdot \NVmx{obs} \approx \frac{1}{2} \cdot \Pm \cdot \NVmx{obs}, \nonumber \\
\NVee{est}    &= \Nee \times \Pee \approx \Nee \times \Pex = \frac{1}{2} \cdot \frac{\Ne-1}{\Nx} \cdot \NVex{obs} \approx \frac{1}{2} \cdot \Pe \cdot \NVex{obs}, \nonumber \\
\NVem{est} &= \Nem \times \Pem \approx \Nem \times \frac{\Pmx + \Pex}{2} = \frac{1}{2} \cdot \bigg(\frac{\Ne}{\Nx} \cdot \NVmx{obs} + \frac{\Nm}{\Nx} \cdot \NVex{obs}\bigg) \nonumber \\
&= \frac{1}{2} \cdot \bigg(\Pe \cdot \NVmx{obs} + \Pm \cdot \NVex{obs}\bigg),
\end{align}
%
where the average of $\Pmx$ and $\Pex$ is used for $e \mu$ vertex.


\subsection{Scale Factors}
The extrapolation of the control (validation) region into the signal region,
\begin{equation}
\mathrm{i.e.}~\xxns~(\muxns, \exns) \rightarrow \mumuns,~\eens,~\emuns, \nonumber
\end{equation}
 uses \Pxx (\Pmx, \Pex) as an approximation of \Pmx, \Pex (\Pmm, \Pee, \Pem). Therefore, these extrapolation into the signal region are corrected by the scale factors obtained from the extrapolation of $\xxns \rightarrow \muxns,~\exns$, defined as,
\begin{align}
    \SxxTOmx &= \frac{\NVmx{obs}}{\NVmx{est}}, \nonumber \\
    \SxxTOex   &= \frac{\NVex{obs}}{ \NVex{est}}
\label{eq:random_crossing_scale_factor}
\end{align}
where $\NVmx{obs}$ and $\NVmx{est}$ ($\NVex{obs}$ and $\NVex{est}$) represent the number of observed track-flipping vertex and the estimated vertex of each type.

Using these results, the scale factors applied to the extrapolation into the signal region are defined as,
\begin{align}
\label{eq:TF_scale_factors}
\SxxTOmm &=  (\SxxTOmx)^{2},  \nonumber\\
\SxxTOee &= (\SxxTOex)^{2},  \nonumber\\
\SxxTOem &= \Big(\frac{1}{2} (\SxxTOmx + \SxxTOex)\Big)^{2}, \nonumber\\
\SmxTOmm &=  \SxxTOmx,  \nonumber\\
\SexTOee &= \SxxTOex,  \nonumber\\
\SemxTOem &= \frac{1}{2} (\SxxTOmx + \SxxTOex),
\end{align}
where the average of $\SxxTOmx$ and $\SxxTOex$ is used for $e \mu$ vertex.



\subsection{Vertex Yields in the TF Method and Data}
\label{sec:tf_raw_yields}
The observed and estimated vertex yields in the TF method and data, and the scale factors calculated from the TF vertex yields are shown in Table~\ref{table:tf_raw_yields}. The extrapolation of xx into the validation region ($\mu$x and $e$x) estimated vertex yields of 3.7 $\mu$x and 5.3 $e$x vertices, which are used to calculate the scale factors.

\begin{table}[!htb]%
  \centering
  \subfloat[Vertex yields]{
    \begin{tabular}[t]{cccc}
        \hline\hline
                & Tracks-flipped (observed) & Track-flipped (estimated) & Data                \\
         \hline
         \xx    & 1255            & -              & 1346                \\
         \mux   & 3               & 3.7              & 4                   \\
         \ex    & 1               & 5.3              & 0                   \\
        \hline\hline
    \end{tabular}
  }%
  \qquad
  \subfloat[Scale factors]{
    \begin{tabular}[t]{cc}
        \hline\hline
         Type               & SF      \\
         \hline
         $\SxxTOmx$         & 0.82    \\
         $\SxxTOex$         & 0.19    \\
        \hline\hline
    \end{tabular}
  }%
  \caption{(a) Vertex yields in the TF and data. (b) The scale factors calculated from the vetex yields}
  \label{table:tf_raw_yields}
\end{table}


